<!DOCTYPE html>
<html lang="tr" data-lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAZ AI Stem Separator</title>
    <link rel="icon" type="image/png" href="/baz-logo.png">
    <link rel="apple-touch-icon" href="/baz-logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000; --bg-secondary: #0a0a0a; --bg-tertiary: #111111;
            --bg-card: #161616; --bg-input: #1a1a1a; --bg-hover: #222222;
            --text-primary: #ffffff; --text-secondary: #a0a0a0; --text-muted: #555555;
            --accent: #2596be; --accent-light: #3ab4e0; --accent-dark: #1d7a9c;
            --border: #262626; --border-focus: #2596be; --success: #22c55e; --error: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary); height: 100vh; line-height: 1.4; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 8px 20px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .logo { display: flex; align-items: center; gap: 8px; font-size: 1.2rem; font-weight: 700; color: var(--text-primary); }
        .logo-icon { width: 28px; height: 28px; background: var(--accent); border-radius: 6px; display: flex; align-items: center; justify-content: center; }
        .header-right { display: flex; align-items: center; gap: 10px; }
        .lang-switcher { display: flex; background: var(--bg-tertiary); border-radius: 6px; padding: 2px; border: 1px solid var(--border); }
        .lang-btn { padding: 4px 10px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 4px; font-size: 11px; font-weight: 500; transition: all 0.2s; }
        .lang-btn.active { background: var(--accent); color: var(--text-primary); }
        .lang-btn:hover:not(.active) { color: var(--text-primary); }
        
        /* Kredi Display */
        .credit-display {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 6px 14px;
            background: linear-gradient(135deg, rgba(37, 150, 190, 0.2), rgba(37, 150, 190, 0.05));
            border: 1px solid rgba(37, 150, 190, 0.4);
            border-radius: 10px;
            margin-right: 12px;
        }
        .credit-info { display: flex; align-items: center; gap: 6px; }
        .credit-icon { font-size: 18px; }
        .credit-count { font-size: 20px; font-weight: 700; color: #2596be; min-width: 30px; text-align: center; }
        .credit-label { font-size: 10px; color: #a0a0a0; text-transform: uppercase; }
        .credit-details { display: flex; flex-direction: column; align-items: flex-start; gap: 2px; }
        .plan-badge { font-size: 9px; font-weight: 600; padding: 2px 8px; background: #6b7280; color: white; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .plan-badge.temel { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .plan-badge.uzman { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .plan-badge.pro { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .plan-badge.none { background: #4b5563; }
        .days-left { font-size: 9px; color: #6b7280; }
        .days-left.warning { color: #f59e0b; }
        .days-left.danger { color: #ef4444; }
        
        /* User Menu */
        .user-menu { position: relative; display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; }
        .user-avatar { width: 28px; height: 28px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; }
        .user-name { font-size: 12px; font-weight: 500; }
        .login-btn { padding: 8px 16px; background: var(--accent); color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .login-btn:hover { background: var(--accent-light); }
        
        /* Main Layout - Sol Men√º, Saƒü Sonu√ßlar */
        .main-container { display: flex; height: calc(100vh - 45px); overflow: hidden; }
        .sidebar { width: 380px; background: var(--bg-secondary); border-right: 1px solid var(--border); padding: 12px 16px; overflow-y: auto; flex-shrink: 0; }
        .results-section { flex: 1; padding: 16px; background: var(--bg-primary); overflow-y: auto; position: relative; }
        
        @media (max-width: 900px) { 
            .main-container { flex-direction: column; } 
            .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--border); max-height: 50vh; } 
            .results-section { max-height: 50vh; }
        }
        
        /* Form Elements */
        .section-title { font-size: 14px; font-weight: 600; color: var(--accent); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 11px; font-weight: 500; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .form-select, .form-input { width: 100%; padding: 10px 12px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 13px; font-family: inherit; transition: all 0.2s; }
        .form-select:focus, .form-input:focus { outline: none; border-color: var(--accent); }
        .form-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23555555' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; background-size: 16px; padding-right: 36px; cursor: pointer; }
        .form-hint { font-size: 10px; color: var(--text-muted); margin-top: 4px; }
        
        /* Tab Switcher */
        .tab-switcher { display: flex; background: var(--bg-tertiary); border-radius: 8px; padding: 3px; border: 1px solid var(--border); margin-bottom: 12px; }
        .tab-btn { flex: 1; padding: 8px 12px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 6px; font-size: 11px; font-weight: 500; transition: all 0.2s; }
        .tab-btn.active { background: var(--accent); color: var(--text-primary); }
        .tab-btn:hover:not(.active) { color: var(--text-primary); }
        
        /* Info Box */
        .info-box { padding: 12px; background: rgba(37, 150, 190, 0.1); border: 1px solid rgba(37, 150, 190, 0.3); border-radius: 8px; margin-bottom: 12px; }
        .info-box strong { display: block; font-size: 11px; color: var(--accent); margin-bottom: 4px; }
        .info-box p { font-size: 10px; color: var(--text-secondary); line-height: 1.5; margin: 0; }
        
        /* Submit Button */
        .submit-btn { width: 100%; padding: 12px 16px; background: var(--accent); color: white; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .submit-btn:hover { background: var(--accent-light); }
        .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Results Area */
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .results-title { font-size: 16px; font-weight: 600; color: var(--accent); }
        .results-empty { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; text-align: center; color: var(--text-muted); }
        .results-empty svg { width: 64px; height: 64px; margin-bottom: 16px; opacity: 0.3; color: var(--accent); }
        .results-empty p { font-size: 14px; max-width: 300px; }
        
        /* Stem Results */
        .stems-container { display: flex; flex-direction: column; gap: 12px; }
        .stem-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; transition: all 0.2s; }
        .stem-item:hover { border-color: var(--accent); }
        .stem-icon { width: 44px; height: 44px; background: var(--bg-tertiary); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .stem-info { flex: 1; }
        .stem-name { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
        .stem-audio { width: 100%; height: 36px; margin-top: 6px; }
        .stem-actions { display: flex; gap: 8px; }
        .stem-btn { padding: 8px 14px; border: 1px solid var(--border); background: var(--bg-tertiary); color: var(--text-primary); border-radius: 6px; font-size: 11px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; display: flex; align-items: center; gap: 4px; }
        .stem-btn:hover { background: var(--bg-hover); border-color: var(--accent); }
        .stem-btn.primary { background: var(--accent); border-color: var(--accent); color: white; }
        .stem-btn.primary:hover { background: var(--accent-light); }
        
        /* History Section */
        .history-section { margin-top: 24px; border-top: 1px solid var(--border); padding-top: 20px; }
        .history-title { font-size: 14px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; }
        .history-item { display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
        .history-item:hover { border-color: var(--accent); }
        .history-icon { font-size: 18px; }
        .history-info { flex: 1; }
        .history-name { font-size: 12px; font-weight: 500; }
        .history-date { font-size: 10px; color: var(--text-muted); }
        .history-type { font-size: 9px; padding: 2px 6px; background: var(--bg-tertiary); border-radius: 4px; color: var(--text-secondary); }
        
        /* Loading Overlay */
        .loading-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(8px); z-index: 200; align-items: center; justify-content: center; flex-direction: column; }
        .loading-overlay.active { display: flex; }
        .loader { width: 48px; height: 48px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 16px; font-size: 16px; font-weight: 500; }
        .loading-status { margin-top: 8px; font-size: 13px; color: var(--accent); }
        .loading-timer { margin-top: 12px; font-size: 24px; color: var(--accent); font-weight: 600; }
        .loading-avg { margin-top: 8px; font-size: 11px; color: var(--text-muted); }
        
        /* Messages */
        .message { padding: 12px 16px; border-radius: 8px; margin-bottom: 12px; font-size: 12px; display: none; }
        .message.error { display: block; background: rgba(239, 68, 68, 0.15); border: 1px solid var(--error); color: #ff6b6b; }
        .message.success { display: block; background: rgba(34, 197, 94, 0.15); border: 1px solid var(--success); color: #4ade80; }
        
        /* Login Modal */
        .login-modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px); z-index: 300; align-items: center; justify-content: center; }
        .login-modal-overlay.active { display: flex; }
        .login-modal { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 16px; padding: 32px; max-width: 400px; width: 90%; text-align: center; }
        .login-modal h2 { font-size: 20px; margin-bottom: 8px; }
        .login-modal p { font-size: 13px; color: var(--text-secondary); margin-bottom: 24px; }
        .login-modal-btn { width: 100%; padding: 14px 20px; background: var(--accent); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 12px; }
        .login-modal-btn:hover { background: var(--accent-light); }
        .login-modal-close { width: 100%; padding: 12px 20px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 10px; font-size: 13px; cursor: pointer; }
        
        /* ≈ûarkƒ± Se√ßim Listesi */
        .track-list { max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px; }
        .track-option { display: flex; align-items: center; gap: 10px; padding: 10px 12px; cursor: pointer; transition: all 0.2s; border-bottom: 1px solid var(--border); }
        .track-option:last-child { border-bottom: none; }
        .track-option:hover { background: var(--bg-hover); }
        .track-option.selected { background: rgba(37, 150, 190, 0.2); border-color: var(--accent); }
        .track-option-icon { font-size: 16px; }
        .track-option-info { flex: 1; }
        .track-option-title { font-size: 12px; font-weight: 500; }
        .track-option-meta { font-size: 10px; color: var(--text-muted); }
        .track-option-check { width: 18px; height: 18px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .track-option.selected .track-option-check { background: var(--accent); border-color: var(--accent); }
        .track-option.selected .track-option-check::after { content: '‚úì'; color: white; font-size: 10px; }
        
        /* Empty Track List */
        .empty-tracks { padding: 24px; text-align: center; color: var(--text-muted); }
        .empty-tracks svg { width: 40px; height: 40px; margin-bottom: 8px; opacity: 0.4; }
        .empty-tracks p { font-size: 12px; }
        
        /* No Login Warning */
        .no-login-warning { padding: 16px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; margin-bottom: 12px; text-align: center; }
        .no-login-warning p { font-size: 12px; color: #ff6b6b; margin-bottom: 8px; }
        .no-login-warning button { padding: 8px 16px; background: var(--error); color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 500; cursor: pointer; }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
        <p class="loading-text" id="loadingText">Stem Ayrƒ±≈ütƒ±rma</p>
        <p class="loading-status" id="loadingStatus">ƒ∞≈üleniyor...</p>
        <p class="loading-timer" id="loadingTimer">00:00</p>
        <p class="loading-avg" id="loadingAvg">Ortalama i≈ülem s√ºresi: 1-3 dk</p>
    </div>
    
    <!-- Login Modal -->
    <div class="login-modal-overlay" id="loginModal">
        <div class="login-modal">
            <img src="/baz-logo.png" alt="BAZ" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 16px;" onerror="this.style.display='none'">
            <h2 id="loginModalTitle">BAZ AI Stem Separator</h2>
            <p id="loginModalDesc">Stem ayrƒ±≈ütƒ±rma i√ßin hesabƒ±nƒ±za giri≈ü yapmanƒ±z gerekiyor.</p>
            <button class="login-modal-btn" onclick="redirectToWixLogin()" id="loginModalBtn">
                Giri≈ü Yap / Kayƒ±t Ol
            </button>
            <button class="login-modal-close" onclick="closeLoginModal()" id="loginModalClose">
                Kapat
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">üéµ</div>
            <span>BAZ AI Stem Separator</span>
        </div>
        <div class="header-right">
            <!-- Kredi Display (login sonrasƒ± g√∂r√ºn√ºr) -->
            <div class="credit-display" id="creditDisplay" style="display: none;">
                <div class="credit-info">
                    <span class="credit-icon">‚ö°</span>
                    <span class="credit-count" id="creditCount">0</span>
                </div>
                <div class="credit-details">
                    <span class="plan-badge none" id="planBadge">-</span>
                    <span class="days-left" id="daysLeft">-</span>
                </div>
            </div>
            
            <!-- Dil Deƒüi≈ütirici -->
            <div class="lang-switcher">
                <button class="lang-btn active" id="langTR" onclick="setLanguage('tr')">TR</button>
                <button class="lang-btn" id="langEN" onclick="setLanguage('en')">EN</button>
            </div>
            
            <!-- Kullanƒ±cƒ± Men√ºs√º / Login Butonu -->
            <div id="userArea">
                <button class="login-btn" id="loginBtn" onclick="showLoginModal()">Giri≈ü Yap</button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sol Sidebar - Yaratƒ±m Men√ºs√º -->
        <div class="sidebar">
            <div class="section-title">
                <span>üéõÔ∏è</span>
                <span id="sidebarTitle">Stem Ayrƒ±≈ütƒ±rma</span>
            </div>
            
            <div class="message" id="errorMsg"></div>
            <div class="message" id="successMsg"></div>
            
            <!-- Giri≈ü Yapƒ±lmamƒ±≈ü Uyarƒ±sƒ± -->
            <div class="no-login-warning" id="noLoginWarning" style="display: none;">
                <p id="noLoginText">≈ûarkƒ±larƒ±nƒ±za eri≈ümek i√ßin giri≈ü yapƒ±n</p>
                <button onclick="showLoginModal()" id="noLoginBtn">Giri≈ü Yap</button>
            </div>
            
            <form id="stemForm">
                <!-- Kaynak Se√ßimi -->
                <div class="form-group">
                    <label class="form-label" id="labelInputMode">Kaynak Se√ßimi</label>
                    <div class="tab-switcher">
                        <button type="button" class="tab-btn active" id="tabDatabase" onclick="switchInputMode('database')">≈ûarkƒ±larƒ±m</button>
                        <button type="button" class="tab-btn" id="tabManual" onclick="switchInputMode('manual')">Manuel Giri≈ü</button>
                    </div>
                </div>
                
                <!-- Database'den ≈ûarkƒ± Se√ßimi -->
                <div id="databaseSection">
                    <div class="form-group">
                        <label class="form-label" id="labelSelectTrack">≈ûarkƒ± Se√ßin</label>
                        <div class="track-list" id="trackList">
                            <div class="empty-tracks" id="emptyTracks">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>
                                <p id="emptyTracksText">Hen√ºz ≈üarkƒ±nƒ±z yok veya giri≈ü yapmadƒ±nƒ±z</p>
                            </div>
                        </div>
                        <p class="form-hint" id="hintSelectTrack">BAZ AI'da olu≈üturduƒüunuz ≈üarkƒ±lar otomatik y√ºklenir</p>
                    </div>
                </div>
                
                <!-- Manuel Giri≈ü -->
                <div id="manualSection" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Task ID</label>
                        <input type="text" class="form-input" id="manualTaskId" placeholder="√ñrn: abc123...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Audio ID</label>
                        <input type="text" class="form-input" id="manualAudioId" placeholder="√ñrn: xyz789...">
                    </div>
                    <div class="info-box">
                        <strong id="infoManualTitle">Manuel Giri≈ü Nasƒ±l Yapƒ±lƒ±r?</strong>
                        <p id="infoManualDesc">BAZ AI'da olu≈üturduƒüunuz ≈üarkƒ±nƒ±n Task ID ve Audio ID bilgilerini girin. Bu bilgiler ≈üarkƒ± detaylarƒ±nda bulunabilir.</p>
                    </div>
                </div>
                
                <!-- Ayrƒ±≈ütƒ±rma Tipi -->
                <div class="form-group">
                    <label class="form-label" id="labelSeparationType">Ayrƒ±≈ütƒ±rma Tipi</label>
                    <select class="form-select" id="separationType">
                        <option value="separate_vocal">Vokal & Enstr√ºmantal (2 Stem)</option>
                        <option value="split_stem">Detaylƒ± Ayrƒ±≈ütƒ±rma (√áoklu Stem)</option>
                    </select>
                    <p class="form-hint" id="hintSeparationType">Detaylƒ± ayrƒ±≈ütƒ±rma daha uzun s√ºrer</p>
                </div>
                
                <!-- Info Box -->
                <div class="info-box">
                    <strong id="infoTitle">Stem Ayrƒ±≈ütƒ±rma Nedir?</strong>
                    <p id="infoDesc">≈ûarkƒ±nƒ±zƒ± vokal, bas, davul, gitar gibi ayrƒ± par√ßalara ayƒ±rƒ±r. Remix, karaoke veya m√ºzik prod√ºksiyonu i√ßin ideal.</p>
                </div>
                
                <!-- Submit -->
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span>üéµ</span>
                    <span id="submitText">Ayrƒ±≈ütƒ±rmayƒ± Ba≈ülat</span>
                </button>
            </form>
        </div>
        
        <!-- Saƒü Taraf - Sonu√ßlar -->
        <div class="results-section">
            <div class="results-header">
                <h2 class="results-title" id="resultsTitle">Sonu√ßlar</h2>
            </div>
            
            <!-- Bo≈ü Durum -->
            <div class="results-empty" id="resultsEmpty">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                </svg>
                <p id="emptyResultsText">Stem ayrƒ±≈ütƒ±rma sonu√ßlarƒ±nƒ±z burada g√∂r√ºnecek. Sol men√ºden bir ≈üarkƒ± se√ßip ba≈ülayƒ±n.</p>
            </div>
            
            <!-- Stem Sonu√ßlarƒ± -->
            <div class="stems-container" id="stemsContainer" style="display: none;"></div>
            
            <!-- Ge√ßmi≈ü Ayrƒ±≈ütƒ±rmalar -->
            <div class="history-section" id="historySection" style="display: none;">
                <h3 class="history-title" id="historyTitle">Ge√ßmi≈ü Ayrƒ±≈ütƒ±rmalar</h3>
                <div id="historyList"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL DEƒûƒ∞≈ûKENLER ====================
        var currentLang = 'tr';
        var currentInputMode = 'database';
        var authToken = null;
        var currentUser = null;
        var userCredits = 0;
        var userPlan = 'none';
        var userTracks = [];
        var selectedTrack = null;
        var stemHistory = [];
        var timerInterval = null;
        var timerSeconds = 0;
        
        // API Base URL
        var API_BASE_URL = window.location.origin;
        
        // ==================== √áEVƒ∞Rƒ∞LER ====================
        var translations = {
            tr: {
                sidebarTitle: 'Stem Ayrƒ±≈ütƒ±rma',
                labelInputMode: 'Kaynak Se√ßimi',
                tabDatabase: '≈ûarkƒ±larƒ±m',
                tabManual: 'Manuel Giri≈ü',
                labelSelectTrack: '≈ûarkƒ± Se√ßin',
                emptyTracksText: 'Hen√ºz ≈üarkƒ±nƒ±z yok veya giri≈ü yapmadƒ±nƒ±z',
                hintSelectTrack: 'BAZ AI\'da olu≈üturduƒüunuz ≈üarkƒ±lar otomatik y√ºklenir',
                infoManualTitle: 'Manuel Giri≈ü Nasƒ±l Yapƒ±lƒ±r?',
                infoManualDesc: 'BAZ AI\'da olu≈üturduƒüunuz ≈üarkƒ±nƒ±n Task ID ve Audio ID bilgilerini girin.',
                labelSeparationType: 'Ayrƒ±≈ütƒ±rma Tipi',
                optionVocal: 'Vokal & Enstr√ºmantal (2 Stem)',
                optionSplit: 'Detaylƒ± Ayrƒ±≈ütƒ±rma (√áoklu Stem)',
                hintSeparationType: 'Detaylƒ± ayrƒ±≈ütƒ±rma daha uzun s√ºrer',
                infoTitle: 'Stem Ayrƒ±≈ütƒ±rma Nedir?',
                infoDesc: '≈ûarkƒ±nƒ±zƒ± vokal, bas, davul, gitar gibi ayrƒ± par√ßalara ayƒ±rƒ±r. Remix, karaoke veya m√ºzik prod√ºksiyonu i√ßin ideal.',
                submitText: 'Ayrƒ±≈ütƒ±rmayƒ± Ba≈ülat',
                resultsTitle: 'Sonu√ßlar',
                emptyResultsText: 'Stem ayrƒ±≈ütƒ±rma sonu√ßlarƒ±nƒ±z burada g√∂r√ºnecek. Sol men√ºden bir ≈üarkƒ± se√ßip ba≈ülayƒ±n.',
                historyTitle: 'Ge√ßmi≈ü Ayrƒ±≈ütƒ±rmalar',
                loadingText: 'Stem Ayrƒ±≈ütƒ±rma',
                loadingStatus: 'ƒ∞≈üleniyor...',
                loadingAvg: 'Ortalama i≈ülem s√ºresi: 1-3 dk',
                loginBtn: 'Giri≈ü Yap',
                loginModalTitle: 'BAZ AI Stem Separator',
                loginModalDesc: 'Stem ayrƒ±≈ütƒ±rma i√ßin hesabƒ±nƒ±za giri≈ü yapmanƒ±z gerekiyor.',
                loginModalBtn: 'Giri≈ü Yap / Kayƒ±t Ol',
                loginModalClose: 'Kapat',
                noLoginText: '≈ûarkƒ±larƒ±nƒ±za eri≈ümek i√ßin giri≈ü yapƒ±n',
                noLoginBtn: 'Giri≈ü Yap',
                btnDownload: 'ƒ∞ndir',
                btnPlay: 'Oynat',
                stemVocal: 'Vokal',
                stemInstrumental: 'Enstr√ºmantal',
                stemDrums: 'Davul',
                stemBass: 'Bas',
                stemGuitar: 'Gitar',
                stemKeyboard: 'Klavye',
                stemStrings: 'Yaylƒ±lar',
                stemBrass: 'Bakƒ±r √úflemeli',
                stemWoodwinds: 'Tahta √úflemeli',
                stemPercussion: 'Perk√ºsyon',
                stemSynth: 'Synth',
                stemFX: 'Efektler',
                stemBackingVocals: 'Arka Vokal',
                errorPrefix: 'Hata:',
                errorNoTrack: 'L√ºtfen bir ≈üarkƒ± se√ßin',
                errorNoIds: 'Task ID ve Audio ID gerekli',
                errorNoLogin: 'Bu i≈ülem i√ßin giri≈ü yapmalƒ±sƒ±nƒ±z',
                successStem: 'Stem ayrƒ±≈ütƒ±rma tamamlandƒ±!'
            },
            en: {
                sidebarTitle: 'Stem Separation',
                labelInputMode: 'Source Selection',
                tabDatabase: 'My Songs',
                tabManual: 'Manual Entry',
                labelSelectTrack: 'Select Song',
                emptyTracksText: 'No songs yet or not logged in',
                hintSelectTrack: 'Songs created in BAZ AI are loaded automatically',
                infoManualTitle: 'How to Enter Manually?',
                infoManualDesc: 'Enter the Task ID and Audio ID of your song created in BAZ AI.',
                labelSeparationType: 'Separation Type',
                optionVocal: 'Vocal & Instrumental (2 Stems)',
                optionSplit: 'Detailed Separation (Multi Stem)',
                hintSeparationType: 'Detailed separation takes longer',
                infoTitle: 'What is Stem Separation?',
                infoDesc: 'Separates your song into individual parts like vocals, bass, drums, guitar. Ideal for remixes, karaoke or music production.',
                submitText: 'Start Separation',
                resultsTitle: 'Results',
                emptyResultsText: 'Your stem separation results will appear here. Select a song from the left menu to start.',
                historyTitle: 'Previous Separations',
                loadingText: 'Stem Separation',
                loadingStatus: 'Processing...',
                loadingAvg: 'Average processing time: 1-3 min',
                loginBtn: 'Login',
                loginModalTitle: 'BAZ AI Stem Separator',
                loginModalDesc: 'Please login to use stem separation.',
                loginModalBtn: 'Login / Register',
                loginModalClose: 'Close',
                noLoginText: 'Login to access your songs',
                noLoginBtn: 'Login',
                btnDownload: 'Download',
                btnPlay: 'Play',
                stemVocal: 'Vocal',
                stemInstrumental: 'Instrumental',
                stemDrums: 'Drums',
                stemBass: 'Bass',
                stemGuitar: 'Guitar',
                stemKeyboard: 'Keyboard',
                stemStrings: 'Strings',
                stemBrass: 'Brass',
                stemWoodwinds: 'Woodwinds',
                stemPercussion: 'Percussion',
                stemSynth: 'Synth',
                stemFX: 'Effects',
                stemBackingVocals: 'Backing Vocals',
                errorPrefix: 'Error:',
                errorNoTrack: 'Please select a song',
                errorNoIds: 'Task ID and Audio ID required',
                errorNoLogin: 'Please login for this action',
                successStem: 'Stem separation completed!'
            }
        };
        
        // ==================== Dƒ∞L DEƒûƒ∞≈ûTƒ∞RME ====================
        function setLanguage(lang) {
            currentLang = lang;
            var t = translations[lang];
            
            // Butonlarƒ± g√ºncelle
            document.getElementById('langTR').classList.toggle('active', lang === 'tr');
            document.getElementById('langEN').classList.toggle('active', lang === 'en');
            
            // T√ºm metinleri g√ºncelle
            document.getElementById('sidebarTitle').textContent = t.sidebarTitle;
            document.getElementById('labelInputMode').textContent = t.labelInputMode;
            document.getElementById('tabDatabase').textContent = t.tabDatabase;
            document.getElementById('tabManual').textContent = t.tabManual;
            document.getElementById('labelSelectTrack').textContent = t.labelSelectTrack;
            document.getElementById('emptyTracksText').textContent = t.emptyTracksText;
            document.getElementById('hintSelectTrack').textContent = t.hintSelectTrack;
            document.getElementById('infoManualTitle').textContent = t.infoManualTitle;
            document.getElementById('infoManualDesc').textContent = t.infoManualDesc;
            document.getElementById('labelSeparationType').textContent = t.labelSeparationType;
            document.getElementById('hintSeparationType').textContent = t.hintSeparationType;
            document.getElementById('infoTitle').textContent = t.infoTitle;
            document.getElementById('infoDesc').textContent = t.infoDesc;
            document.getElementById('submitText').textContent = t.submitText;
            document.getElementById('resultsTitle').textContent = t.resultsTitle;
            document.getElementById('emptyResultsText').textContent = t.emptyResultsText;
            document.getElementById('historyTitle').textContent = t.historyTitle;
            document.getElementById('loadingText').textContent = t.loadingText;
            document.getElementById('loadingStatus').textContent = t.loadingStatus;
            document.getElementById('loadingAvg').textContent = t.loadingAvg;
            document.getElementById('loginBtn').textContent = t.loginBtn;
            document.getElementById('loginModalTitle').textContent = t.loginModalTitle;
            document.getElementById('loginModalDesc').textContent = t.loginModalDesc;
            document.getElementById('loginModalBtn').textContent = t.loginModalBtn;
            document.getElementById('loginModalClose').textContent = t.loginModalClose;
            document.getElementById('noLoginText').textContent = t.noLoginText;
            document.getElementById('noLoginBtn').textContent = t.noLoginBtn;
            
            // Select options
            var sepType = document.getElementById('separationType');
            sepType.options[0].text = t.optionVocal;
            sepType.options[1].text = t.optionSplit;
        }
        
        // ==================== INPUT MODE DEƒûƒ∞≈ûTƒ∞RME ====================
        function switchInputMode(mode) {
            currentInputMode = mode;
            
            document.getElementById('tabDatabase').classList.toggle('active', mode === 'database');
            document.getElementById('tabManual').classList.toggle('active', mode === 'manual');
            document.getElementById('databaseSection').style.display = mode === 'database' ? 'block' : 'none';
            document.getElementById('manualSection').style.display = mode === 'manual' ? 'block' : 'none';
        }
        
        // ==================== AUTH Sƒ∞STEMƒ∞ ====================
        function getTokenFromURL() {
            var urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('token');
        }
        
        async function checkAuthStatus() {
            // URL'den token al
            var urlToken = getTokenFromURL();
            if (urlToken) {
                authToken = urlToken;
                localStorage.setItem('bazai_stem_token', urlToken);
                // URL'den token'ƒ± temizle
                window.history.replaceState({}, document.title, window.location.pathname);
            } else {
                // localStorage'dan token al
                authToken = localStorage.getItem('bazai_stem_token');
            }
            
            if (authToken) {
                await syncUserData();
            } else {
                showNoLoginState();
            }
        }
        
        async function syncUserData() {
            if (!authToken) return;
            
            try {
                var response = await fetch(API_BASE_URL + '/api/auth-sync', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authToken
                    }
                });
                
                var data = await response.json();
                
                if (data.success && data.user) {
                    currentUser = data.user;
                    userCredits = data.user.credits || 0;
                    userPlan = data.user.planId || data.user.plan || 'none';
                    
                    updateUserUI();
                    await loadUserTracks();
                    await loadStemHistory();
                } else {
                    // Token ge√ßersiz
                    localStorage.removeItem('bazai_stem_token');
                    authToken = null;
                    showNoLoginState();
                }
            } catch (error) {
                console.error('Sync error:', error);
                showNoLoginState();
            }
        }
        
        function updateUserUI() {
            // Login butonunu gizle, kullanƒ±cƒ± men√ºs√ºn√º g√∂ster
            var userArea = document.getElementById('userArea');
            userArea.innerHTML = '<div class="user-menu" onclick="toggleUserMenu()">' +
                '<div class="user-avatar">' + (currentUser.displayName ? currentUser.displayName.charAt(0).toUpperCase() : 'U') + '</div>' +
                '<span class="user-name">' + (currentUser.displayName || currentUser.email || 'Kullanƒ±cƒ±') + '</span>' +
            '</div>';
            
            // Kredi display'i g√∂ster
            document.getElementById('creditDisplay').style.display = 'flex';
            document.getElementById('creditCount').textContent = userCredits;
            
            // Plan badge
            var planBadge = document.getElementById('planBadge');
            planBadge.textContent = userPlan.charAt(0).toUpperCase() + userPlan.slice(1);
            planBadge.className = 'plan-badge ' + userPlan;
            
            // Kalan g√ºn
            if (currentUser.daysRemaining !== undefined) {
                var daysLeft = document.getElementById('daysLeft');
                daysLeft.textContent = currentUser.daysRemaining + ' g√ºn kaldƒ±';
                if (currentUser.daysRemaining <= 7) daysLeft.classList.add('danger');
                else if (currentUser.daysRemaining <= 30) daysLeft.classList.add('warning');
            }
            
            // No login uyarƒ±sƒ±nƒ± gizle
            document.getElementById('noLoginWarning').style.display = 'none';
        }
        
        function showNoLoginState() {
            document.getElementById('noLoginWarning').style.display = 'block';
            document.getElementById('creditDisplay').style.display = 'none';
            
            var userArea = document.getElementById('userArea');
            userArea.innerHTML = '<button class="login-btn" id="loginBtn" onclick="showLoginModal()">' + 
                translations[currentLang].loginBtn + '</button>';
        }
        
        // ==================== DATABASE'DEN ≈ûARKI Y√úKLEME ====================
        async function loadUserTracks() {
            if (!authToken) {
                userTracks = [];
                renderTrackList();
                return;
            }
            
            try {
                var response = await fetch(API_BASE_URL + '/api/user-data', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + authToken
                    }
                });
                
                var data = await response.json();
                
                if (data.success && data.data && data.data.tracks) {
                    userTracks = data.data.tracks;
                } else {
                    userTracks = [];
                }
                
                renderTrackList();
            } catch (error) {
                console.error('Load tracks error:', error);
                userTracks = [];
                renderTrackList();
            }
        }
        
        function renderTrackList() {
            var container = document.getElementById('trackList');
            var t = translations[currentLang];
            
            if (!userTracks || userTracks.length === 0) {
                container.innerHTML = '<div class="empty-tracks" id="emptyTracks">' +
                    '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>' +
                    '<p id="emptyTracksText">' + t.emptyTracksText + '</p>' +
                '</div>';
                return;
            }
            
            var html = '';
            userTracks.forEach(function(track, index) {
                var isSelected = selectedTrack && selectedTrack.id === track.id;
                var date = track.addedAt ? new Date(track.addedAt).toLocaleDateString() : '';
                
                html += '<div class="track-option ' + (isSelected ? 'selected' : '') + '" onclick="selectTrack(' + index + ')">' +
                    '<span class="track-option-icon">üéµ</span>' +
                    '<div class="track-option-info">' +
                        '<div class="track-option-title">' + (track.title || '≈ûarkƒ± ' + (index + 1)) + '</div>' +
                        '<div class="track-option-meta">' + (track.style || '') + (date ? ' ‚Ä¢ ' + date : '') + '</div>' +
                    '</div>' +
                    '<div class="track-option-check"></div>' +
                '</div>';
            });
            
            container.innerHTML = html;
        }
        
        function selectTrack(index) {
            selectedTrack = userTracks[index];
            renderTrackList();
        }
        
        // ==================== STEM GE√áMƒ∞≈ûƒ∞ ====================
        async function loadStemHistory() {
            // LocalStorage'dan y√ºkle (veya API'den)
            var saved = localStorage.getItem('bazai_stem_history');
            if (saved) {
                stemHistory = JSON.parse(saved);
                renderHistory();
            }
        }
        
        function saveStemToHistory(stemData) {
            var historyItem = {
                id: Date.now(),
                trackName: selectedTrack ? selectedTrack.title : 'Manuel Giri≈ü',
                type: document.getElementById('separationType').value,
                date: new Date().toISOString(),
                stems: stemData
            };
            
            stemHistory.unshift(historyItem);
            if (stemHistory.length > 20) stemHistory = stemHistory.slice(0, 20);
            
            localStorage.setItem('bazai_stem_history', JSON.stringify(stemHistory));
            renderHistory();
        }
        
        function renderHistory() {
            var container = document.getElementById('historyList');
            var section = document.getElementById('historySection');
            var t = translations[currentLang];
            
            if (!stemHistory || stemHistory.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            
            var html = '';
            stemHistory.forEach(function(item, index) {
                var date = new Date(item.date).toLocaleDateString();
                var typeLabel = item.type === 'separate_vocal' ? 'Vokal' : 'Detaylƒ±';
                
                html += '<div class="history-item" onclick="showHistoryItem(' + index + ')">' +
                    '<span class="history-icon">üéõÔ∏è</span>' +
                    '<div class="history-info">' +
                        '<div class="history-name">' + item.trackName + '</div>' +
                        '<div class="history-date">' + date + '</div>' +
                    '</div>' +
                    '<span class="history-type">' + typeLabel + '</span>' +
                '</div>';
            });
            
            container.innerHTML = html;
        }
        
        function showHistoryItem(index) {
            var item = stemHistory[index];
            if (item && item.stems) {
                displayStemResults(item.stems, item.type);
            }
        }
        
        // ==================== LOGIN MODAL ====================
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        function redirectToWixLogin() {
            // Wix login sayfasƒ±na y√∂nlendir
            var wixLoginUrl = 'https://www.burakayaz.com/_functions/login?redirect=' + 
                encodeURIComponent(window.location.href);
            window.location.href = wixLoginUrl;
        }
        
        // ==================== TIMER ====================
        function startTimer() {
            timerSeconds = 0;
            updateTimerDisplay();
            timerInterval = setInterval(function() {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        function updateTimerDisplay() {
            var minutes = Math.floor(timerSeconds / 60);
            var seconds = timerSeconds % 60;
            document.getElementById('loadingTimer').textContent = 
                String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
        }
        
        // ==================== MESAJLAR ====================
        function showError(message) {
            var el = document.getElementById('errorMsg');
            el.textContent = message;
            el.classList.add('error');
            el.style.display = 'block';
            setTimeout(function() {
                el.style.display = 'none';
                el.classList.remove('error');
            }, 5000);
        }
        
        function showSuccess(message) {
            var el = document.getElementById('successMsg');
            el.textContent = message;
            el.classList.add('success');
            el.style.display = 'block';
            setTimeout(function() {
                el.style.display = 'none';
                el.classList.remove('success');
            }, 5000);
        }
        
        // ==================== STEM AYRI≈ûTIRMA ====================
        document.getElementById('stemForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            var t = translations[currentLang];
            
            var taskId, audioId;
            
            if (currentInputMode === 'database') {
                if (!selectedTrack) {
                    showError(t.errorPrefix + ' ' + t.errorNoTrack);
                    return;
                }
                taskId = selectedTrack.taskId;
                audioId = selectedTrack.audioId || selectedTrack.id;
            } else {
                taskId = document.getElementById('manualTaskId').value.trim();
                audioId = document.getElementById('manualAudioId').value.trim();
                if (!taskId || !audioId) {
                    showError(t.errorPrefix + ' ' + t.errorNoIds);
                    return;
                }
            }
            
            var separationType = document.getElementById('separationType').value;
            
            // Loading g√∂ster
            document.getElementById('loadingOverlay').classList.add('active');
            document.getElementById('stemsContainer').style.display = 'none';
            document.getElementById('resultsEmpty').style.display = 'flex';
            startTimer();
            
            try {
                var headers = { 'Content-Type': 'application/json' };
                if (authToken) {
                    headers['Authorization'] = 'Bearer ' + authToken;
                }
                
                var res = await fetch(API_BASE_URL + '/api/stem', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        taskId: taskId,
                        audioId: audioId,
                        type: separationType,
                        callBackUrl: API_BASE_URL + '/api/stem-webhook'
                    })
                });
                
                var data = await res.json();
                if (!res.ok || (data.code !== 200 && !data.taskId)) {
                    throw new Error(data.msg || data.error || data.details || 'Hata');
                }
                
                var newTaskId = data.data ? data.data.taskId : data.taskId;
                pollStemStatus(newTaskId, separationType);
                
            } catch (err) {
                stopTimer();
                document.getElementById('loadingOverlay').classList.remove('active');
                showError(t.errorPrefix + ' ' + err.message);
            }
        });
        
        async function pollStemStatus(taskId, separationType) {
            var t = translations[currentLang];
            var attempts = 0;
            var maxAttempts = 60;
            
            var interval = setInterval(async function() {
                attempts++;
                document.getElementById('loadingStatus').textContent = t.loadingStatus + ' (' + attempts + ')';
                
                try {
                    var res = await fetch(API_BASE_URL + '/api/stem-status?taskId=' + taskId);
                    var json = await res.json();
                    
                    if (json.code === 200 && json.data && json.data.vocal_separation_info) {
                        clearInterval(interval);
                        stopTimer();
                        document.getElementById('loadingOverlay').classList.remove('active');
                        
                        var stemInfo = json.data.vocal_separation_info;
                        displayStemResults(stemInfo, separationType);
                        saveStemToHistory(stemInfo);
                        showSuccess(t.successStem);
                    }
                    
                    if (attempts >= maxAttempts) {
                        clearInterval(interval);
                        stopTimer();
                        document.getElementById('loadingOverlay').classList.remove('active');
                        showError('Zaman a≈üƒ±mƒ± - l√ºtfen tekrar deneyin');
                    }
                } catch (e) {
                    console.error('Poll error:', e);
                }
            }, 5000);
        }
        
        function displayStemResults(info, separationType) {
            var t = translations[currentLang];
            var container = document.getElementById('stemsContainer');
            container.innerHTML = '';
            
            var stems = [];
            
            if (separationType === 'separate_vocal') {
                if (info.vocal_url) stems.push({ name: t.stemVocal, url: info.vocal_url, icon: 'üé§' });
                if (info.instrumental_url) stems.push({ name: t.stemInstrumental, url: info.instrumental_url, icon: 'üé∏' });
            } else {
                if (info.vocal_url) stems.push({ name: t.stemVocal, url: info.vocal_url, icon: 'üé§' });
                if (info.backing_vocals_url) stems.push({ name: t.stemBackingVocals, url: info.backing_vocals_url, icon: 'üéôÔ∏è' });
                if (info.drums_url) stems.push({ name: t.stemDrums, url: info.drums_url, icon: 'ü•Å' });
                if (info.bass_url) stems.push({ name: t.stemBass, url: info.bass_url, icon: 'üé∏' });
                if (info.guitar_url) stems.push({ name: t.stemGuitar, url: info.guitar_url, icon: 'üé∏' });
                if (info.keyboard_url) stems.push({ name: t.stemKeyboard, url: info.keyboard_url, icon: 'üéπ' });
                if (info.strings_url) stems.push({ name: t.stemStrings, url: info.strings_url, icon: 'üéª' });
                if (info.brass_url) stems.push({ name: t.stemBrass, url: info.brass_url, icon: 'üé∫' });
                if (info.woodwinds_url) stems.push({ name: t.stemWoodwinds, url: info.woodwinds_url, icon: 'üé∑' });
                if (info.percussion_url) stems.push({ name: t.stemPercussion, url: info.percussion_url, icon: 'ü™ò' });
                if (info.synth_url) stems.push({ name: t.stemSynth, url: info.synth_url, icon: 'üéõÔ∏è' });
                if (info.fx_url) stems.push({ name: t.stemFX, url: info.fx_url, icon: '‚ú®' });
            }
            
            stems.forEach(function(stem) {
                var html = '<div class="stem-item">' +
                    '<div class="stem-icon">' + stem.icon + '</div>' +
                    '<div class="stem-info">' +
                        '<div class="stem-name">' + stem.name + '</div>' +
                        '<audio class="stem-audio" controls src="' + stem.url + '"></audio>' +
                    '</div>' +
                    '<div class="stem-actions">' +
                        '<a href="' + stem.url + '" download class="stem-btn primary">' + t.btnDownload + '</a>' +
                    '</div>' +
                '</div>';
                container.innerHTML += html;
            });
            
            document.getElementById('resultsEmpty').style.display = 'none';
            container.style.display = 'flex';
        }
        
        // ==================== BA≈ûLATMA ====================
        document.addEventListener('DOMContentLoaded', function() {
            setLanguage('tr');
            checkAuthStatus();
        });
    </script>
</body>
</html>
